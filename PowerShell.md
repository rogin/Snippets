# PowerShell

## GitHub star list

See [here](https://github.com/stars/rogin/lists/rust).

## Converting to int and string

Examples from [here](https://hostingultraso.com/help/windows/convert-numbers-between-bases-windows-powershell)

````powershell
# Convert accepts bases 2, 8, 10, and 16
PS >[Convert]::ToInt32("10011010010", 2)
1234
PS >[Convert]::ToString(1234, 16)
4d2
# or use the formatting operator
PS >"{0:X4}" -f 1234
04D2
````

## Using -split with "|"

Be sure to escape the pipe as it's a special character, or substitute Split() instead.

````powershell
# does not match expectations
PS >"foo|bar" -split "|"

f
o
o
|
b
a
r

# escaping the pipe parses as expected
PS >"foo|bar" -split "\|"
foo
bar

# you can also opt for Split() to ignore special chars
PS >"foo|bar".Split("|")
foo
bar
````

## pre-sized arrays

from [here](https://learn.microsoft.com/en-us/powershell/scripting/learn/deep-dives/everything-about-arrays?view=powershell-7.2#initialize-with-0)

````powershell
PS> [int[]]::new(4)
0
0
0
0
#We can use the multiplying trick to do this too.
PS> $data = @(0) * 4
PS> $data
0
0
0
0
````

## Tracing commands

Use [_trace-command_](https://learn.microsoft.com/en-us/powershell/module/Microsoft.PowerShell.Utility/Trace-Command?view=powershell-7.3)

````powershell
trace-command -expression {"g*","s*" | Get-Alias } -name parameterbinding -pshost
#to see all options for -name above
Get-TraceSource
````

## Nuggets from "The PowerShell Scripting and Toolmaking Book"

### Transcripts

Use Start-Transcript and Stop-Transcript to write all actions taken (along with their output) to a file.

### Write-Information

From two sections in , use this to add tags to its output which can then be filtered.

````powershell
$r = "thinkp1","srv1","srv3","bovine320" |
Get-Bits -InformationVariable iv -Verbose
#All of the information records generated by Write-Information are stored in $iv. These are objects
#with their own set of properties.
````

### Make Powershell ISE 'aware' of v7

````powershell
Enter-PSSession -computername $env:COMPUTERNAME -Configuration PowerShell.7
#This hack will open a remoting session to yourself using the PowerShell 7
#endpoint. Now, the scripting panel will be PowerShell 7 “aware”.
````

### New in v7

- Ternary

````powershell
$IsWindows ? "ok":"not ok"
````

- Chain operators

````powershell
1 && 2
1/0 || Write-Warning "What are you trying to do?"
````

- Null-Coalescing Assignment

````powershell
$foo = $null
$foo ?? "bar"
Related to this is the Null-Coalescing assignment operator, ??=.
<left-side> ??= <right-side>
$computername ??= ([system.environment]::MachineName)
````

- Null Conditional Operators

````powershell
$p = Get-Process -id $pid
${p}?.startTime
````

- ForEach-Object Parallel

````powershell
Measure-Command {1..1000 | ForEach-Object -parallel {$_*10}}
````

- SSH for remoting

## Where() accepts multiple params

See [here](https://mcpmag.com/articles/2015/12/02/where-method-in-powershell.aspx).

````powershell
@(1,2,3).Where({$_ -gt 0}, 'first')
#1
 @(1,2,3).Where({$_ -gt 0}, 'first', 2)
#1
#2
@(1,2,3).Where({$_ -gt 10}, 'first')
@(1,2,3).Where({$_ -gt 10}, 'first', 2)
$Running,$Stopped = (Get-Service).Where({$_.Status -eq 'Running'},'Split') 
#use $Running and $Stopped
````

## Helpful links

<https://devblogs.microsoft.com/powershell-community/cheat-sheet-console-experience/>

[Various gotchas](https://github.com/devops-collective-inc/big-book-of-powershell-gotchas/blob/master/SUMMARY.md)

[Unit testing vs integration testing](https://www.guru99.com/unit-test-vs-integration-test.html)

[Info on system testing](https://testsigma.com/blog/system-testing-vs-integration-testing/) and [another](https://u-tor.com/topic/system-vs-integration)
